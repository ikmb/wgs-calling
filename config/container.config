
// Job paramaters to set for this environment

params.outdir = "output" 

params.splitter = "/home/sukmb352/git/ikmb-wgs-alignment/bin/split_and_compress.sh"

params.picard_jar = "/opt/picard/2.9.2/picard.jar"
params.trimmomatic = "/opt/trimmomatic/0.36"

params.leading = 3
params.trailing = 3
params.slidingwindow = "4:15"
params.minlen = 36
params.adapters = "TruSeq3-PE-2.fa"

params.scratch = true

// Resource manager settings

executor {
  name="slurm"
  queueSize=100
}

singularity {
	enabled = true
	autoMounts = true
	runOptions = "-B /ifs/data/nfs_share:/ifs/data/nfs_share -B /scratch:/scratch"
}


// Process setting
process.container = "/ifs/data/nfs_share/ikmb_repository/references/singularity/images/ikmb-wgs-pipelines.img"

process {

  // Global cluster parameters
  executor = 'slurm'
  queue = 'ikmb_new'
  clusterOptions = { '--qos=ikmb_a' }
  memory = { 8.GB * task.attempt }
  cpus = { 1 * task.attempt }
  time = { 2.h * task.attempt }
  errorStrategy = { task.exitStatus == 143 ? 'retry' : 'finish' }
  maxRetries = 3
  maxErrors = '-1'

  // Specific cluster parameters for each process

  $SplitFile {
    time = { 6.h * task.attempt }
    cpus = 20
  }

  $runBwa {
    module = [ 'singularity2.4.4' ]
    memory = "48GB"
    time = { 8.h * task.attempt }
    cpus = 10
  }

  $runTrimmomatic {
     cpus = 10
     time = { 8.h * task.attempt }
     memory = "16GB"
  }

  $runMergeCram {
     memory = "120GB"
     cpus = 20
     time = { 8.h * task.attempt }
  }

  $runMarkDuplicates { 
     memory = "122GB"
     cpus = 2
     time = { 48.h * task.attempt }   
  }

  $runBaseRecalibrator {
    time = { 24.h * task.attempt }
    memory = "64GB"
    cpus = 2
  }

  $runApplyBQSR {
    time = { 72.h * task.attempt }
    memory = "26GB"
  }

  $runBaseRecalibratorPostRecal {
    time = { 12.h * task.attempt }
  }

  $runConcatVcf {
     time = { 8.h * task.attempt }
     memory = "64GB"
  }

  $runAnalyzeCovariates {
    time = { 12.h * task.attempt }
  }
 
  $runDepthOfCoverage { 
    time = { 12.h * task.attempt }
  }

  $runCollectMultipleMetrics {
    time = { 18.h * task.attempt }
    memory = "25GB"
  }

  $runMergedFastqc {
    time = { 8.h * task.attempt }
    cpus = 20
  }

  $runMultiQCFastq {
     time = {  4.h * task.attempt }
     memory = "7GB"
  }

  $runMultiQCLibrary {
     time = {  4.h * task.attempt }
     memory = "7GB"
  }

  $runMultiQCSample {
     time = {  4.h * task.attempt }
     memory = "7GB"
  }

  $runHCSample {
    cpus=4
    memory = { 25.GB * task.attempt }
    time = { 8.h * task.attempt }
  } 

  $runGenomicsDBImport {
     memory = { 25.GB * task.attempt }
     time = { 4.h * task.attempt }
  } 

  $runJoinedGenotyping {
        cpus=10
        memory = { 48.GB * task.attempt }
        time = { 48.h * task.attempt }
  }

  $combineVariantsFromGenotyping {
	time = { 12.h * task.attempt }
	memory = "26GB"
  }

  $runRecalibrationModeSNP {
	cpus=10
	memory = { 25.GB * task.attempt }
	time = { 16.h * task.attempt }
  }

  $runRecalibrationModeIndel {
        cpus=10
        memory = { 25.GB * task.attempt }
        time = { 16.h * task.attempt }
  }

  $runRecalIndelApply {
        memory = { 25.GB * task.attempt }
        time = { 16.h * task.attempt }
  }

  $runRecalSNPApply {
        memory = { 25.GB * task.attempt }
        time = { 16.h * task.attempt }
  } 

  $runVariantFiltrationIndel {
        memory = { 25.GB * task.attempt }
        time = { 8.h * task.attempt }
  }

  $runCombineVariants {
        memory = { 8.GB * task.attempt }
        time = { 12.h * task.attempt }
  }

}

params {

   genomes {
	'hg38' {
                fasta = "/ifs/data/nfs_share/ikmb_repository/references/gatk/bundle/hg38/Homo_sapiens_assembly38.fasta"
                dbsnp = "/ifs/data/nfs_share/ikmb_repository/references/gatk/bundle/hg38/dbsnp_146.hg38.vcf.gz"
                gold = "/ifs/data/nfs_share/ikmb_repository/references/gatk/bundle/hg38/Mills_and_1000G_gold_standard.indels.hg38.vcf.gz"
		g1k = "/ifs/data/nfs_share/ikmb_repository/references/gatk/bundle/hg38/1000G_phase1.snps.high_confidence.hg38.vcf.gz"
		hapmap = "/ifs/data/nfs_share/ikmb_repository/references/gatk/bundle/hg38/hapmap_3.3.hg38.vcf.gz"
		omni = "/ifs/data/nfs_share/ikmb_repository/references/gatk/bundle/hg38/1000G_omni2.5.hg38.vcf.gz"
		intervals = "/ifs/data/nfs_share/ikmb_repository/references/gatk/bundle/hg38/wgs_calling_regions.hg38.intervals"
		dict = "/ifs/data/nfs_share/ikmb_repository/references/gatk/bundle/hg38/Homo_sapiens_assembly38.dict"
	}
	'GRCh37' {
		fasta = "/ifs/data/nfs_share/ikmb_repository/references/gatk/bundle/2.8/b37/human_g1k_v37_decoy.clean.fasta"
		index = "/ifs/data/nfs_share/ikmb_repository/references/gatk/bundle/2.8/b37/human_g1k_v37_decoy.clean.mmi"
		dbsnp = "/ifs/data/nfs_share/ikmb_repository/references/gatk/bundle/2.8/b37/dbsnp_138.b37.vcf.gz"
		gold = "/ifs/data/nfs_share/ikmb_repository/references/gatk/bundle/2.8/b37/Mills_and_1000G_gold_standard.indels.b37.vcf.gz"
		g1k = "/ifs/data/nfs_share/ikmb_repository/references/gatk/bundle/2.8/b37/1000G_phase1.snps.high_confidence.b37.vcf.gz"
		omni = "/ifs/data/nfs_share/ikmb_repository/references/gatk/bundle/2.8/b37/1000G_omni2.5.b37.vcf.gz"
		hapmap = "/ifs/data/nfs_share/ikmb_repository/references/gatk/bundle/2.8/b37/hapmap_3.3.b37.vcf.gz"
		dict = "/ifs/data/nfs_share/ikmb_repository/references/gatk/bundle/2.8/b37/human_g1k_v37_decoy.clean.dict"
		intervals = "/ifs/data/nfs_share/ikmb_repository/references/gatk/bundle/2.8/b37/b37_wgs_calling_regions.v1.intervals"
	}
	'test' {
		fasta = "/ifs/data/nfs_share/ikmb_repository/references/gatk/bundle/2.8/test_data/chr17.fa"
                dbsnp = "/ifs/data/nfs_share/ikmb_repository/references/gatk/bundle/2.8/test_data/dbsnp_138.hg19.vcf.gz"
                gold = "/ifs/data/nfs_share/ikmb_repository/references/gatk/bundle/2.8/test_data/Mills_and_1000G_gold_standard.indels.hg19.sites.vcf.gz"
                g1k = "/ifs/data/nfs_share/ikmb_repository/references/gatk/bundle/2.8/test_data/1000G_phase1.indels.hg19.sites.vcf.gz"
                omni = "/ifs/data/nfs_share/ikmb_repository/references/gatk/bundle/2.8/test_data/1000G_omni2.5.hg19.sites.vcf.gz"
                hapmap = "/ifs/data/nfs_share/ikmb_repository/references/gatk/bundle/2.8/test_data/hapmap_3.3.hg19.sites.vcf.gz"
	}

   }

}
